<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Scott Oatley</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Scott Oatley</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../presentations/index.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../training/index.html"> 
<span class="menu-text">Training</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projects/index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Scott0atley"> <i class="bi bi-GitHub" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/Scott_Oatley_"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/scott-oatley-b87408157/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:mail.s2265605@ed.ac.uk"> <i class="bi bi-envelope" role="img" aria-label="email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">




<p>Before any analysis. Both the R kernal and Stata kernal need to be properly setup. First start with R. We first need to install the correct Python to R package using pip.</p>
<div id="a6f10185-efa3-4e62-8016-13a13f5f2c9e" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pip install rpy2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: rpy2 in /opt/anaconda3/lib/python3.12/site-packages (3.5.17)
Requirement already satisfied: cffi&gt;=1.15.1 in /opt/anaconda3/lib/python3.12/site-packages (from rpy2) (1.17.1)
Requirement already satisfied: jinja2 in /opt/anaconda3/lib/python3.12/site-packages (from rpy2) (3.1.4)
Requirement already satisfied: tzlocal in /opt/anaconda3/lib/python3.12/site-packages (from rpy2) (5.3.1)
Requirement already satisfied: pycparser in /opt/anaconda3/lib/python3.12/site-packages (from cffi&gt;=1.15.1-&gt;rpy2) (2.21)
Requirement already satisfied: MarkupSafe&gt;=2.0 in /opt/anaconda3/lib/python3.12/site-packages (from jinja2-&gt;rpy2) (2.1.3)
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<p>After we have done this we then need to setup R within the Python kernal</p>
<div id="24abd9fa-8c4f-468f-843b-721e63821b85" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext rpy2.ipython</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally a quick little test to make sure R now works. Anytime we want R code to run we have to use the magic cells %%R.</p>
<div id="188b2a35-0230-4ea1-816a-4734171a906b" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">&lt;-</span> c(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>mean(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>Now we have to install the python to stata dependecies to get Stata to work in a Python kernal. We start by installing the pystata package.</p>
<div id="dee711b1-e754-47eb-b9ee-91f41f7d73a9" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pip install pystata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: pystata in /opt/anaconda3/lib/python3.12/site-packages (0.0.1)
Requirement already satisfied: pandas in /opt/anaconda3/lib/python3.12/site-packages (from pystata) (2.2.2)
Requirement already satisfied: numpy&gt;=1.26.0 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;pystata) (1.26.4)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;pystata) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;pystata) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;pystata) (2023.3)
Requirement already satisfied: six&gt;=1.5 in /opt/anaconda3/lib/python3.12/site-packages (from python-dateutil&gt;=2.8.2-&gt;pandas-&gt;pystata) (1.16.0)
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<p>We then also install the stata_setup package.</p>
<div id="25e255e7-8b94-42f7-baf5-886584e4bbaa" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pip install <span class="op">--</span>upgrade <span class="op">--</span>user stata_setup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: stata_setup in /Users/scottoatley/.local/lib/python3.12/site-packages (0.1.3)
Requirement already satisfied: numpy in /opt/anaconda3/lib/python3.12/site-packages (from stata_setup) (1.26.4)
Requirement already satisfied: pandas in /opt/anaconda3/lib/python3.12/site-packages (from stata_setup) (2.2.2)
Requirement already satisfied: ipython in /opt/anaconda3/lib/python3.12/site-packages (from stata_setup) (8.27.0)
Requirement already satisfied: decorator in /opt/anaconda3/lib/python3.12/site-packages (from ipython-&gt;stata_setup) (5.1.1)
Requirement already satisfied: jedi&gt;=0.16 in /opt/anaconda3/lib/python3.12/site-packages (from ipython-&gt;stata_setup) (0.19.1)
Requirement already satisfied: matplotlib-inline in /opt/anaconda3/lib/python3.12/site-packages (from ipython-&gt;stata_setup) (0.1.6)
Requirement already satisfied: prompt-toolkit&lt;3.1.0,&gt;=3.0.41 in /opt/anaconda3/lib/python3.12/site-packages (from ipython-&gt;stata_setup) (3.0.43)
Requirement already satisfied: pygments&gt;=2.4.0 in /opt/anaconda3/lib/python3.12/site-packages (from ipython-&gt;stata_setup) (2.15.1)
Requirement already satisfied: stack-data in /opt/anaconda3/lib/python3.12/site-packages (from ipython-&gt;stata_setup) (0.2.0)
Requirement already satisfied: traitlets&gt;=5.13.0 in /opt/anaconda3/lib/python3.12/site-packages (from ipython-&gt;stata_setup) (5.14.3)
Requirement already satisfied: pexpect&gt;4.3 in /opt/anaconda3/lib/python3.12/site-packages (from ipython-&gt;stata_setup) (4.8.0)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;stata_setup) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;stata_setup) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;stata_setup) (2023.3)
Requirement already satisfied: parso&lt;0.9.0,&gt;=0.8.3 in /opt/anaconda3/lib/python3.12/site-packages (from jedi&gt;=0.16-&gt;ipython-&gt;stata_setup) (0.8.3)
Requirement already satisfied: ptyprocess&gt;=0.5 in /opt/anaconda3/lib/python3.12/site-packages (from pexpect&gt;4.3-&gt;ipython-&gt;stata_setup) (0.7.0)
Requirement already satisfied: wcwidth in /opt/anaconda3/lib/python3.12/site-packages (from prompt-toolkit&lt;3.1.0,&gt;=3.0.41-&gt;ipython-&gt;stata_setup) (0.2.5)
Requirement already satisfied: six&gt;=1.5 in /opt/anaconda3/lib/python3.12/site-packages (from python-dateutil&gt;=2.8.2-&gt;pandas-&gt;stata_setup) (1.16.0)
Requirement already satisfied: executing in /opt/anaconda3/lib/python3.12/site-packages (from stack-data-&gt;ipython-&gt;stata_setup) (0.8.3)
Requirement already satisfied: asttokens in /opt/anaconda3/lib/python3.12/site-packages (from stack-data-&gt;ipython-&gt;stata_setup) (2.0.5)
Requirement already satisfied: pure-eval in /opt/anaconda3/lib/python3.12/site-packages (from stack-data-&gt;ipython-&gt;stata_setup) (0.2.2)
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<p>We now import that stata_setup package into the python kernal.</p>
<div id="42248c78-0941-43f7-b85a-a13ee7347f56" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> stata_setup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And finally we import Stata itself into the kernal.</p>
<div id="7dc861f1-1ef0-4a85-a0ce-6a5e46b44b71" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>stata_setup.config(<span class="st">"/Applications/Stata"</span>, <span class="st">"se"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      18.0
___/   /   /___/   /   /___/       SE—Standard Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-STATA-PC        https://www.stata.com
                                   979-696-4600        stata@stata.com

Stata license: Unlimited-user network, expiring 14 Sep 2025
Serial number: 401809305318
  Licensed to: Scott oatley
               University of Edinburgh

Notes:
      1. Unicode is supported; see help unicode_advice.
      2. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.</code></pre>
</div>
</div>
<p>And we now test that Stata works by doing a simple test using display.</p>
<div id="e2190b53-cd97-409e-a54f-51c08377546c" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>stata</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>display <span class="dv">1</span><span class="op">+</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
. 
. display 1+1
2

. </code></pre>
</div>
</div>
<p>And now back to R to make sure they both can run at the same time.</p>
<div id="fb8e4fec-b9b8-4ac9-be96-fcaf404e02d7" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">&lt;-</span> c(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,NA)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">is</span>.na(y) <span class="co"># returns a vector (F F F T)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE  TRUE</code></pre>
</div>
</div>
<p>Each handling missing data method will now be explored using the four aforementioned software programs: R, Stata, Python, and Mplus. Some methods are not possible with certain software, when this happens, only relevant software will be mentioned. We start with a simple simulation of an OLS linear regression model with three continuous independent variables that are normally distributed with means ranging from 40-200 and standard deviations ranging from 5-50. First we start with R, then Stata, then Python, and finally Mplus.</p>
<p>All methods will be produced.</p>
<div id="f083af98-a797-40e6-9213-516c80b1e535" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary library</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>.seed(<span class="dv">123</span>)  <span class="co"># Ensure reproducibility</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric independent variables</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">40</span>, sd <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">200</span>, sd <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">150</span>, sd <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric dependent variable</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>y <span class="op">&lt;-</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">5000</span>, sd <span class="op">=</span> <span class="dv">1500</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>data <span class="op">&lt;-</span> data.frame(y, x1, x2, x3)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Run regression</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>model <span class="op">&lt;-</span> lm(y <span class="op">~</span> x1 <span class="op">+</span> x2 <span class="op">+</span> x3, data <span class="op">=</span> data)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>summary(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2 + x3, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-4584.3  -950.2     0.7  1012.9  4338.4 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 2726.9512  1462.4421   1.865   0.0625 .  
x1            29.8375     3.9740   7.508 1.33e-13 ***
x2            39.7564     0.9369  42.432  &lt; 2e-16 ***
x3            65.4442     9.6348   6.792 1.89e-11 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1489 on 996 degrees of freedom
Multiple R-squared:  0.6662,    Adjusted R-squared:  0.6652 
F-statistic: 662.5 on 3 and 996 DF,  p-value: &lt; 2.2e-16
</code></pre>
</div>
</div>
<p>This is the same as this in Stata:</p>
<div id="3a8b5ca7-11a5-4c5a-a9ff-7d7beeee168e" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>stata</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set seed</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> seed <span class="dv">123</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set number of observations</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> obs <span class="dv">1000</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#1</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>drawnorm x1, n(<span class="dv">1000</span>) means(<span class="dv">40</span>) sds(<span class="dv">12</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#2</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>drawnorm x2, n(<span class="dv">1000</span>) means(<span class="dv">200</span>) sds(<span class="dv">50</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#3</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>drawnorm x3, n(<span class="dv">1000</span>) means(<span class="dv">150</span>) sds(<span class="dv">5</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric dependent variable <span class="cf">with</span> large coefficients</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>gen y <span class="op">=</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnormal(<span class="dv">5000</span>, <span class="dv">1500</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Run Model</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>regress y x1 x2 x3</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>etable</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>twoway (scatter y x2) (lfit y x2), title(<span class="st">"Scatter Plot with Line of Best Fit"</span>) legend(off)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
. 
. * Set seed
. set seed 123

. 
. * Set number of observations
. set obs 1000
Number of observations (_N) was 0, now 1,000.

. 
. * Generate metric independent variable #1
. drawnorm x1, n(1000) means(40) sds(12)

. 
. * Generate metric independent variable #2
. drawnorm x2, n(1000) means(200) sds(50)

. 
. * Generate metric independent variable #3
. drawnorm x3, n(1000) means(150) sds(5)

. 
. * Generate metric dependent variable with large coefficients
. gen y = 30*x1 + 40*x2 + 50*x3 + rnormal(5000, 1500)

. 
. * Run Model
. regress y x1 x2 x3

      Source |       SS           df       MS      Number of obs   =     1,000
-------------+----------------------------------   F(3, 996)       =    714.04
       Model |  4.7321e+09         3  1.5774e+09   Prob &gt; F        =    0.0000
    Residual |  2.2002e+09       996  2209043.89   R-squared       =    0.6826
-------------+----------------------------------   Adj R-squared   =    0.6817
       Total |  6.9323e+09       999  6939202.43   Root MSE        =    1486.3

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |    29.4092   4.032441     7.29   0.000     21.49614    37.32225
          x2 |   42.71715   .9441681    45.24   0.000     40.86437    44.56994
          x3 |   54.51955   9.245538     5.90   0.000     36.37658    72.66252
       _cons |   3778.896   1402.667     2.69   0.007     1026.375    6531.417
------------------------------------------------------------------------------

. 
. etable

---------------------------------
                            y    
---------------------------------
x1                         29.409
                          (4.032)
x2                         42.717
                          (0.944)
x3                         54.520
                          (9.246)
Intercept                3778.896
                       (1402.667)
Number of observations       1000
---------------------------------

. 
. twoway (scatter y x2) (lfit y x2), title("Scatter Plot with Line of Best Fit"
&gt; ) legend(off)

. </code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Handling_Missing_Data_Methods_Software_files/figure-html/cell-12-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Now don’t worry too much that the results from the models aren’t exactly perfect. That is because we have different seeds for each software. Substantively they are the same and that is all that matters here. Now for Python.</p>
<div id="2b66da25-dd1b-4dc2-89e1-396031103b4b" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric independent variables</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> np.random.normal(loc<span class="op">=</span><span class="dv">40</span>, scale<span class="op">=</span><span class="dv">12</span>, size<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> np.random.normal(loc<span class="op">=</span><span class="dv">200</span>, scale<span class="op">=</span><span class="dv">50</span>, size<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">=</span> np.random.normal(loc<span class="op">=</span><span class="dv">150</span>, scale<span class="op">=</span><span class="dv">5</span>, size<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric dependent variable</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> np.random.normal(loc<span class="op">=</span><span class="dv">5000</span>, scale<span class="op">=</span><span class="dv">1500</span>, size<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'y'</span>: y, <span class="st">'x1'</span>: x1, <span class="st">'x2'</span>: x2, <span class="st">'x3'</span>: x3})</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Run regression</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">'x1'</span>, <span class="st">'x2'</span>, <span class="st">'x3'</span>]]  <span class="co"># Independent variables</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)  <span class="co"># Add intercept</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(df[<span class="st">'y'</span>], X).fit()  <span class="co"># Fit model</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summary</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.618
Model:                            OLS   Adj. R-squared:                  0.617
Method:                 Least Squares   F-statistic:                     537.7
Date:                Sun, 06 Apr 2025   Prob (F-statistic):          1.03e-207
Time:                        13:35:34   Log-Likelihood:                -8719.9
No. Observations:                1000   AIC:                         1.745e+04
Df Residuals:                     996   BIC:                         1.747e+04
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const       5257.2104   1467.373      3.583      0.000    2377.713    8136.707
x1            26.4715      3.914      6.764      0.000      18.792      34.151
x2            38.7536      0.981     39.513      0.000      36.829      40.678
x3            51.5446      9.574      5.384      0.000      32.757      70.332
==============================================================================
Omnibus:                        2.499   Durbin-Watson:                   1.897
Prob(Omnibus):                  0.287   Jarque-Bera (JB):                2.519
Skew:                           0.122   Prob(JB):                        0.284
Kurtosis:                       2.964   Cond. No.                     8.01e+03
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 8.01e+03. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<p>And finally, as Mplus as written through R. Currently, no access to full MPlus licence which does cause some issues with getting MPlus to run properly. For now this is all the MPlus I can produce.</p>
<div id="d3adc5c6-4c71-424d-b87e-f88b207f284f" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>install.packages(<span class="st">"MplusAutomation"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>install.packages(<span class="st">"texreg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Please select a CRAN mirror for use in this session ---
Secure CRAN mirrors 

 1: 0-Cloud [https]
 2: Australia (Canberra) [https]
 3: Australia (Melbourne 1) [https]
 4: Australia (Melbourne 2) [https]
 5: Austria (Wien 1) [https]
 6: Belgium (Brussels) [https]
 7: Brazil (PR) [https]
 8: Brazil (SP 1) [https]
 9: Brazil (SP 2) [https]
10: Bulgaria [https]
11: Canada (ON 1) [https]
12: Canada (ON 2) [https]
13: Chile (Santiago) [https]
14: China (Beijing 1) [https]
15: China (Beijing 2) [https]
16: China (Beijing 3) [https]
17: China (Hefei) [https]
18: China (Hong Kong) [https]
19: China (Jinan) [https]
20: China (Lanzhou) [https]
21: China (Nanjing) [https]
22: China (Shanghai 2) [https]
23: China (Shenzhen) [https]
24: China (Wuhan) [https]
25: Colombia (Cali) [https]
26: Costa Rica [https]
27: Cyprus [https]
28: Czech Republic [https]
29: Denmark [https]
30: East Asia [https]
31: Ecuador (Cuenca) [https]
32: Finland (Helsinki) [https]
33: France (Lyon 1) [https]
34: France (Lyon 2) [https]
35: France (Paris 1) [https]
36: Germany (Erlangen) [https]
37: Germany (Göttingen) [https]
38: Germany (Leipzig) [https]
39: Germany (Münster) [https]
40: Greece [https]
41: Hungary [https]
42: Iceland [https]
43: India (Bengaluru) [https]
44: India (Bhubaneswar) [https]
45: Indonesia (Banda Aceh) [https]
46: Iran (Mashhad) [https]
47: Italy (Milano) [https]
48: Italy (Padua) [https]
49: Japan (Yonezawa) [https]
50: Korea (Gyeongsan-si) [https]
51: Mexico (Mexico City) [https]
52: Mexico (Texcoco) [https]
53: Morocco [https]
54: Netherlands (Dronten) [https]
55: New Zealand [https]
56: Norway [https]
57: Poland [https]
58: South Africa (Johannesburg) [https]
59: Spain (A Coruña) [https]
60: Spain (Madrid) [https]
61: Sweden (Umeå) [https]
62: Switzerland (Zurich 1) [https]
63: Taiwan (Taipei) [https]
64: Turkey (Denizli) [https]
65: UK (Bristol) [https]
66: UK (London 1) [https]
67: USA (IA) [https]
68: USA (MI) [https]
69: USA (MO) [https]
70: USA (OH) [https]
71: USA (OR) [https]
72: USA (PA 1) [https]
73: USA (TN) [https]
74: USA (UT) [https]
75: United Arab Emirates [https]
76: Uruguay [https]
77: (other mirrors)


The downloaded binary packages are in
    /var/folders/5m/wtp81d3x2vx4v3kw6v37qj180000gn/T//RtmprBoE5j/downloaded_packages

The downloaded binary packages are in
    /var/folders/5m/wtp81d3x2vx4v3kw6v37qj180000gn/T//RtmprBoE5j/downloaded_packages</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>Selection:  67</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>trying URL 'https://mirror.las.iastate.edu/CRAN/bin/macosx/big-sur-arm64/contrib/4.4/MplusAutomation_1.1.1.tgz'
Content type 'application/x-gzip' length 2769853 bytes (2.6 MB)
==================================================
downloaded 2.6 MB

trying URL 'https://mirror.las.iastate.edu/CRAN/bin/macosx/big-sur-arm64/contrib/4.4/texreg_1.39.4.tgz'
Content type 'application/x-gzip' length 1340319 bytes (1.3 MB)
==================================================
downloaded 1.3 MB

In addition: Warning message:
In doTryCatch(return(expr), name, parentenv, handler) :
  unable to load shared object '/Library/Frameworks/R.framework/Resources/modules//R_X11.so':
  dlopen(/Library/Frameworks/R.framework/Resources/modules//R_X11.so, 0x0006): Library not loaded: /opt/X11/lib/libSM.6.dylib
  Referenced from: &lt;31EADEB5-0A17-3546-9944-9B3747071FE8&gt; /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/modules/R_X11.so
  Reason: tried: '/opt/X11/lib/libSM.6.dylib' (no such file), '/System/Volumes/Preboot/Cryptexes/OS/opt/X11/lib/libSM.6.dylib' (no such file), '/opt/X11/lib/libSM.6.dylib' (no such file), '/usr/local/lib/libSM.6.dylib' (no such file), '/usr/lib/libSM.6.dylib' (no such file, not in dyld cache)</code></pre>
</div>
</div>
<div id="61260fb5-65ad-47ac-8679-a0acd720a1bf" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>library(MplusAutomation)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>library(texreg)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the OLS linear regression model</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>olsModel <span class="op">&lt;-</span> mplusObject(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  TITLE <span class="op">=</span> <span class="st">"OLS Linear Regression Model in Mplus;"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  MODEL <span class="op">=</span> <span class="st">"</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="er">     mpg ON hp wt;",  # mpg as dependent variable, hp and wt as independent variables</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  OUTPUT <span class="op">=</span> <span class="st">"CINTERVAL;"</span>,  <span class="co"># Request confidence intervals for estimates</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  rdata <span class="op">=</span> mtcars  <span class="co"># Use the mtcars dataset</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>fit_ols <span class="op">&lt;-</span> mplusModeler(olsModel, modelout <span class="op">=</span> <span class="st">"ols_model.inp"</span>, run <span class="op">=</span> <span class="dv">1L</span>)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display fit statistics</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>screenreg(fit_ols, summaries <span class="op">=</span> c(<span class="st">"Observations"</span>, <span class="st">"CFI"</span>, <span class="st">"SRMR"</span>), single.row <span class="op">=</span> TRUE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
==================================
                  TITLE           
----------------------------------
 MPG&lt;-HP          -0.03 (0.01) ***
 MPG&lt;-WT          -3.88 (0.60) ***
 MPG&lt;-Intercepts  37.23 (1.52) ***
 MPG&lt;-&gt;MPG         6.10 (1.52) ***
----------------------------------
Observations      32              
CFI                1.00           
SRMR               0.00           
==================================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05
 FALSE</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Version:  1.1.1
We work hard to write this free software. Please help us get credit by citing: 

Hallquist, M. N. &amp; Wiley, J. F. (2018). MplusAutomation: An R Package for Facilitating Large-Scale Latent Variable Analyses in Mplus. Structural Equation Modeling, 25, 621-638. doi: 10.1080/10705511.2017.1402334.

-- see citation("MplusAutomation").
Version:  1.39.4
Date:     2024-07-23
Author:   Philip Leifeld (University of Manchester)

Consider submitting praise using the praise or praise_interactive functions.
Please cite the JSS article in your publications -- see citation("texreg").</code></pre>
</div>
</div>
<p>The simple OLS linear regression model has now been conducted. We now perform the same model under a sem framework.</p>
<div id="3b62ea04-0a54-463c-ac78-12bfbf2420d9" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>stata</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>clear</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set seed</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> seed <span class="dv">123</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set number of observations</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> obs <span class="dv">1000</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#1</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>drawnorm x1, n(<span class="dv">1000</span>) means(<span class="dv">40</span>) sds(<span class="dv">12</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#2</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>drawnorm x2, n(<span class="dv">1000</span>) means(<span class="dv">200</span>) sds(<span class="dv">50</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#3</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>drawnorm x3, n(<span class="dv">1000</span>) means(<span class="dv">150</span>) sds(<span class="dv">5</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric dependent variable <span class="cf">with</span> large coefficients</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>gen y <span class="op">=</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnormal(<span class="dv">5000</span>, <span class="dv">1500</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>sem (y <span class="op">&lt;-</span> x1 x2 x3), method(mlmv)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>etable, append </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
. 
. clear

. 
. * Set seed
. set seed 123

. 
. * Set number of observations
. set obs 1000
Number of observations (_N) was 0, now 1,000.

. 
. * Generate metric independent variable #1
. drawnorm x1, n(1000) means(40) sds(12)

. 
. * Generate metric independent variable #2
. drawnorm x2, n(1000) means(200) sds(50)

. 
. * Generate metric independent variable #3
. drawnorm x3, n(1000) means(150) sds(5)

. 
. * Generate metric dependent variable with large coefficients
. gen y = 30*x1 + 40*x2 + 50*x3 + rnormal(5000, 1500)

. 
. sem (y &lt;- x1 x2 x3), method(mlmv)

Endogenous variables
  Observed: y

Exogenous variables
  Observed: x1 x2 x3

Fitting target model:
Iteration 0:  Log likelihood = -20967.462  
Iteration 1:  Log likelihood = -20967.462  

Structural equation model                                Number of obs = 1,000
Estimation method: mlmv

Log likelihood = -20967.462

------------------------------------------------------------------------------
             |                 OIM
             | Coefficient  std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
Structural   |
  y          |
          x1 |    29.4092   4.024368     7.31   0.000     21.52158    37.29681
          x2 |   42.71715   .9422779    45.33   0.000     40.87032    44.56398
          x3 |   54.51955   9.227029     5.91   0.000     36.43491     72.6042
       _cons |   3778.896   1399.858     2.70   0.007     1035.223    6522.568
-------------+----------------------------------------------------------------
     var(e.y)|    2200208   98396.28                       2015565     2401765
------------------------------------------------------------------------------
LR test of model vs. saturated: chi2(0) = 0.00                 Prob &gt; chi2 = .

. 
. etable, append 

---------------------------------------------
                            y          2     
---------------------------------------------
x1                         29.409      29.409
                          (4.032)     (4.024)
x2                         42.717      42.717
                          (0.944)     (0.942)
x3                         54.520      54.520
                          (9.246)     (9.227)
Intercept                3778.896    3778.896
                       (1402.667)  (1399.858)
var(e.y)                             2.20e+06
                                  (98396.280)
Number of observations       1000        1000
---------------------------------------------

. </code></pre>
</div>
</div>
<div id="c093c5ce-d3ca-4d7e-a44b-c8fa52c99b04" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>library(lavaan)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>library(MASS)  <span class="co"># For mvrnorm (multivariate normal distribution)</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>.seed(<span class="dv">123</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric independent variables</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">40</span>, sd <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">200</span>, sd <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">150</span>, sd <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric dependent variable</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>y <span class="op">&lt;-</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">5000</span>, sd <span class="op">=</span> <span class="dv">1500</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>data <span class="op">&lt;-</span> data.frame(y, x1, x2, x3)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the SEM model</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>sem_model <span class="op">&lt;-</span> <span class="st">'</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="er">  y ~ x1 + x2 + x3</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="co">'</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="er"># Fit the model using Maximum Likelihood with Missing Values </span>(MLMV)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>fit <span class="op">&lt;-</span> sem(sem_model, data <span class="op">=</span> data, missing <span class="op">=</span> <span class="st">"ml"</span>)</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Print model summary</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>summary(fit, fit.measures <span class="op">=</span> TRUE, standardized <span class="op">=</span> TRUE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-18 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         5

  Number of observations                          1000
  Number of missing patterns                         1

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Model Test Baseline Model:

  Test statistic                              1097.097
  Degrees of freedom                                 3
  P-value                                        0.000

User Model versus Baseline Model:

  Comparative Fit Index (CFI)                    1.000
  Tucker-Lewis Index (TLI)                       1.000
                                                      
  Robust Comparative Fit Index (CFI)             1.000
  Robust Tucker-Lewis Index (TLI)                1.000

Loglikelihood and Information Criteria:

  Loglikelihood user model (H0)              -8722.665
  Loglikelihood unrestricted model (H1)      -8722.665
                                                      
  Akaike (AIC)                               17455.330
  Bayesian (BIC)                             17479.869
  Sample-size adjusted Bayesian (SABIC)      17463.989

Root Mean Square Error of Approximation:

  RMSEA                                          0.000
  90 Percent confidence interval - lower         0.000
  90 Percent confidence interval - upper         0.000
  P-value H_0: RMSEA &lt;= 0.050                       NA
  P-value H_0: RMSEA &gt;= 0.080                       NA
                                                      
  Robust RMSEA                                   0.000
  90 Percent confidence interval - lower         0.000
  90 Percent confidence interval - upper         0.000
  P-value H_0: Robust RMSEA &lt;= 0.050                NA
  P-value H_0: Robust RMSEA &gt;= 0.080                NA

Standardized Root Mean Square Residual:

  SRMR                                           0.000

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Observed
  Observed information based on                Hessian

Regressions:
                   Estimate     Std.Err   z-value  P(&gt;|z|)   Std.lv     Std.all
  y ~                                                                          
    x1                  29.837     3.966    7.523    0.000      29.837    0.138
    x2                  39.756     0.935   42.518    0.000      39.756    0.780
    x3                  65.444     9.616    6.806    0.000      65.444    0.124

Intercepts:
                   Estimate     Std.Err   z-value  P(&gt;|z|)   Std.lv     Std.all
   .y                 2726.951  1459.514    1.868    0.062    2726.951    1.060

Variances:
                   Estimate     Std.Err   z-value  P(&gt;|z|)   Std.lv     Std.all
   .y              2207681.041 98745.450   22.357    0.000 2207681.041    0.334
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>This is lavaan 0.6-18
lavaan is FREE software! Please report any bugs.
In addition: Warning messages:
1: lavaan-&gt;lav_data_full():  
   some observed variances are larger than 1000000 use varTable(fit) to 
   investigate 
2: lavaan-&gt;lavData():  
   some observed variances in the sample covariance matrix are larger than 
   1000000. 
3: lavaan-&gt;lavData():  
   some observed variances in the sample covariance matrix are larger than 
   1000000. 
4: lavaan-&gt;lavData():  
   some observed variances in the sample covariance matrix are larger than 
   1000000. 
5: lavaan-&gt;lavData():  
   some observed variances in the sample covariance matrix are larger than 
   1000000. </code></pre>
</div>
</div>
<div id="2f0113e6-bf58-4ea9-b03c-75d37a5dcf2f" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>pip install semopy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: semopy in /opt/anaconda3/lib/python3.12/site-packages (2.3.11)
Requirement already satisfied: scipy in /opt/anaconda3/lib/python3.12/site-packages (from semopy) (1.13.1)
Requirement already satisfied: numpy in /opt/anaconda3/lib/python3.12/site-packages (from semopy) (1.26.4)
Requirement already satisfied: pandas in /opt/anaconda3/lib/python3.12/site-packages (from semopy) (2.2.2)
Requirement already satisfied: sympy in /opt/anaconda3/lib/python3.12/site-packages (from semopy) (1.13.2)
Requirement already satisfied: scikit-learn in /opt/anaconda3/lib/python3.12/site-packages (from semopy) (1.5.1)
Requirement already satisfied: statsmodels in /opt/anaconda3/lib/python3.12/site-packages (from semopy) (0.14.2)
Requirement already satisfied: numdifftools in /opt/anaconda3/lib/python3.12/site-packages (from semopy) (0.9.41)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;semopy) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;semopy) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in /opt/anaconda3/lib/python3.12/site-packages (from pandas-&gt;semopy) (2023.3)
Requirement already satisfied: joblib&gt;=1.2.0 in /opt/anaconda3/lib/python3.12/site-packages (from scikit-learn-&gt;semopy) (1.4.2)
Requirement already satisfied: threadpoolctl&gt;=3.1.0 in /opt/anaconda3/lib/python3.12/site-packages (from scikit-learn-&gt;semopy) (3.5.0)
Requirement already satisfied: patsy&gt;=0.5.6 in /opt/anaconda3/lib/python3.12/site-packages (from statsmodels-&gt;semopy) (0.5.6)
Requirement already satisfied: packaging&gt;=21.3 in /opt/anaconda3/lib/python3.12/site-packages (from statsmodels-&gt;semopy) (24.1)
Requirement already satisfied: mpmath&lt;1.4,&gt;=1.1.0 in /opt/anaconda3/lib/python3.12/site-packages (from sympy-&gt;semopy) (1.3.0)
Requirement already satisfied: six in /opt/anaconda3/lib/python3.12/site-packages (from patsy&gt;=0.5.6-&gt;statsmodels-&gt;semopy) (1.16.0)
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<div id="3b9bcce9-7acb-4fe8-83b5-f10bf3c56a26" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> semopy <span class="im">import</span> Model</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seed for reproducibility</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric independent variables</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> np.random.normal(loc<span class="op">=</span><span class="dv">40</span>, scale<span class="op">=</span><span class="dv">12</span>, size<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> np.random.normal(loc<span class="op">=</span><span class="dv">200</span>, scale<span class="op">=</span><span class="dv">50</span>, size<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">=</span> np.random.normal(loc<span class="op">=</span><span class="dv">150</span>, scale<span class="op">=</span><span class="dv">5</span>, size<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric dependent variable</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> np.random.normal(loc<span class="op">=</span><span class="dv">5000</span>, scale<span class="op">=</span><span class="dv">1500</span>, size<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame({<span class="st">'y'</span>: y, <span class="st">'x1'</span>: x1, <span class="st">'x2'</span>: x2, <span class="st">'x3'</span>: x3})</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the SEM model in semopy syntax</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>sem_model <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="st">y ~ x1 + x2 + x3</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit the model</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model(sem_model)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>model.fit(data)</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Print model results</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.inspect())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  lval  op rval      Estimate       Std. Err    z-value       p-value
0    y   ~   x1  2.826314e+01       4.470083   6.322734  2.569751e-10
1    y   ~   x2  3.870783e+01       1.120236  34.553275  0.000000e+00
2    y   ~   x3  9.507102e+00      10.935110   0.869411  3.846225e-01
3    y  ~~    y  2.875963e+06  128616.985180  22.360680  0.000000e+00</code></pre>
</div>
</div>
<div id="eca3c51f-ae63-4980-8aa1-acda1fa76b95" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>library(MplusAutomation)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>library(texreg)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the SEM model</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>semModel <span class="op">&lt;-</span> mplusObject(</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  TITLE <span class="op">=</span> <span class="st">"Structural Equation Model (SEM) in Mplus;"</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  MODEL <span class="op">=</span> <span class="st">"</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="er">     mpg ON hp wt;",  # Regression model in SEM form</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  OUTPUT <span class="op">=</span> <span class="st">"STANDARDIZED CINTERVAL;"</span>,  <span class="co"># Request standardized results and confidence intervals</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  rdata <span class="op">=</span> mtcars  <span class="co"># Use the mtcars dataset</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the SEM model in Mplus</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>fit_sem <span class="op">&lt;-</span> mplusModeler(</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  semModel, </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  modelout <span class="op">=</span> <span class="st">"sem_model.inp"</span>,  <span class="co"># Output .inp file</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  run <span class="op">=</span> <span class="dv">1L</span>                     <span class="co"># Run the model after writing input</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Display model fit statistics</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>screenreg(fit_sem, summaries <span class="op">=</span> c(<span class="st">"Observations"</span>, <span class="st">"CFI"</span>, <span class="st">"SRMR"</span>), single.row <span class="op">=</span> TRUE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
==================================
                  TITLE           
----------------------------------
 MPG&lt;-HP          -0.03 (0.01) ***
 MPG&lt;-WT          -3.88 (0.60) ***
 MPG&lt;-Intercepts  37.23 (1.52) ***
 MPG&lt;-&gt;MPG         6.10 (1.52) ***
----------------------------------
Observations      32              
CFI                1.00           
SRMR               0.00           
==================================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05
 FALSE</code></pre>
</div>
</div>
<p>Now we move on to a simple MCAR model. Starting with Stata.</p>
<div id="fe0ea86d-a5c7-44e4-9446-a6b477dacecc" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>stata</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>clear</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set seed</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> seed <span class="dv">123</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set number of observations</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> obs <span class="dv">1000</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#1</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>drawnorm x1, n(<span class="dv">1000</span>) means(<span class="dv">40</span>) sds(<span class="dv">12</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#2</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>drawnorm x2, n(<span class="dv">1000</span>) means(<span class="dv">200</span>) sds(<span class="dv">50</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#3</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>drawnorm x3, n(<span class="dv">1000</span>) means(<span class="dv">150</span>) sds(<span class="dv">5</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric dependent variable <span class="cf">with</span> large coefficients</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>gen y <span class="op">=</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnormal(<span class="dv">5000</span>, <span class="dv">1500</span>)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate MCAR </span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>gen rmcar <span class="op">=</span> rbinomial(<span class="dv">1</span>, <span class="fl">0.5</span>)  <span class="op">//</span> MCAR: <span class="dv">50</span><span class="op">%</span> chance of missingness (binary random)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>replace x2 <span class="op">=</span> . <span class="cf">if</span> rmcar <span class="op">==</span> <span class="dv">0</span>  <span class="op">//</span> Set x to missing where rmcar <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>regress y x1 x2 x3</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>etable, append</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>twoway (scatter y x2) (lfit y x2), title(<span class="st">"Scatter Plot with Line of Best Fit"</span>) legend(off)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
. 
. clear

. 
. * Set seed
. set seed 123

. 
. * Set number of observations
. set obs 1000
Number of observations (_N) was 0, now 1,000.

. 
. * Generate metric independent variable #1
. drawnorm x1, n(1000) means(40) sds(12)

. 
. * Generate metric independent variable #2
. drawnorm x2, n(1000) means(200) sds(50)

. 
. * Generate metric independent variable #3
. drawnorm x3, n(1000) means(150) sds(5)

. 
. * Generate metric dependent variable with large coefficients
. gen y = 30*x1 + 40*x2 + 50*x3 + rnormal(5000, 1500)

. 
. * Generate MCAR 
. gen rmcar = rbinomial(1, 0.5)  // MCAR: 50% chance of missingness (binary ran
&gt; dom)

. replace x2 = . if rmcar == 0  // Set x to missing where rmcar == 0
(492 real changes made, 492 to missing)

. 
. regress y x1 x2 x3

      Source |       SS           df       MS      Number of obs   =       508
-------------+----------------------------------   F(3, 504)       =    325.45
       Model |  2.3023e+09         3   767444127   Prob &gt; F        =    0.0000
    Residual |  1.1885e+09       504  2358099.32   R-squared       =    0.6595
-------------+----------------------------------   Adj R-squared   =    0.6575
       Total |  3.4908e+09       507  6885235.58   Root MSE        =    1535.6

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |   25.21384    5.94201     4.24   0.000     13.53968      36.888
          x2 |   42.55748   1.384992    30.73   0.000     39.83641    45.27855
          x3 |   48.17947   13.13299     3.67   0.000     22.37733    73.98162
       _cons |   4912.711   2007.467     2.45   0.015     968.6771    8856.744
------------------------------------------------------------------------------

. 
. etable, append

--------------------------------------------------------
                            y          2           y    
--------------------------------------------------------
x1                         29.409      29.409     25.214
                          (4.032)     (4.024)    (5.942)
x2                         42.717      42.717     42.557
                          (0.944)     (0.942)    (1.385)
x3                         54.520      54.520     48.179
                          (9.246)     (9.227)   (13.133)
Intercept                3778.896    3778.896   4912.711
                       (1402.667)  (1399.858) (2007.467)
var(e.y)                             2.20e+06           
                                  (98396.280)           
Number of observations       1000        1000        508
--------------------------------------------------------

. 
. twoway (scatter y x2) (lfit y x2), title("Scatter Plot with Line of Best Fit"
&gt; ) legend(off)

. 
. </code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Handling_Missing_Data_Methods_Software_files/figure-html/cell-21-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="3866e008-45e6-4c60-9dbc-7aa38bf826d5" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>.seed(<span class="dv">123</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric independent variables</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">40</span>, sd <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">200</span>, sd <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">150</span>, sd <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric dependent variable</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>y <span class="op">&lt;-</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">5000</span>, sd <span class="op">=</span> <span class="dv">1500</span>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Introduce 50% Missing Completely at Random (MCAR) in x2</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>rmcar <span class="op">&lt;-</span> rbinom(<span class="dv">1000</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)  <span class="co"># Binary indicator: 50% missingness</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>x2[rmcar <span class="op">==</span> <span class="dv">0</span>] <span class="op">&lt;-</span> NA        <span class="co"># Set x2 to NA for half the observations</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>data <span class="op">&lt;-</span> data.frame(y, x1, x2, x3)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Run OLS regression (handling missing data with listwise deletion by default)</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">&lt;-</span> lm(y <span class="op">~</span> x1 <span class="op">+</span> x2 <span class="op">+</span> x3, data <span class="op">=</span> data)</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display regression results</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>summary(ols_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2 + x3, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-4464.9 -1057.0   -31.6  1042.2  4294.4 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  386.332   2177.578   0.177    0.859    
x1            29.499      5.908   4.993 8.28e-07 ***
x2            40.483      1.364  29.671  &lt; 2e-16 ***
x3            80.047     14.416   5.553 4.62e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1548 on 489 degrees of freedom
  (507 observations deleted due to missingness)
Multiple R-squared:  0.6697,    Adjusted R-squared:  0.6677 
F-statistic: 330.5 on 3 and 489 DF,  p-value: &lt; 2.2e-16
</code></pre>
</div>
</div>
<div id="cd3726b0-9cbc-4970-a1ff-124c909b5bb3" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set number of observations</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate independent variables</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> np.random.normal(loc<span class="op">=</span><span class="dv">40</span>, scale<span class="op">=</span><span class="dv">12</span>, size<span class="op">=</span>n)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> np.random.normal(loc<span class="op">=</span><span class="dv">200</span>, scale<span class="op">=</span><span class="dv">50</span>, size<span class="op">=</span>n)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">=</span> np.random.normal(loc<span class="op">=</span><span class="dv">150</span>, scale<span class="op">=</span><span class="dv">5</span>, size<span class="op">=</span>n)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate dependent variable</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> np.random.normal(loc<span class="op">=</span><span class="dv">5000</span>, scale<span class="op">=</span><span class="dv">1500</span>, size<span class="op">=</span>n)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Introduce 50% Missing Completely at Random (MCAR) in x2</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>rmcar <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, <span class="fl">0.5</span>, size<span class="op">=</span>n)  <span class="co"># Binary indicator: 50% missingness</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>x2[rmcar <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> np.nan  <span class="co"># Set x2 to NaN for half the observations</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame({<span class="st">'y'</span>: y, <span class="st">'x1'</span>: x1, <span class="st">'x2'</span>: x2, <span class="st">'x3'</span>: x3})</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with missing values (listwise deletion) and run OLS regression</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>data_complete <span class="op">=</span> data.dropna()  <span class="co"># Remove rows with NaN</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data_complete[[<span class="st">'x1'</span>, <span class="st">'x2'</span>, <span class="st">'x3'</span>]]</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)  <span class="co"># Add intercept</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data_complete[<span class="st">'y'</span>]</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit OLS model</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.631
Model:                            OLS   Adj. R-squared:                  0.629
Method:                 Least Squares   F-statistic:                     295.0
Date:                Sun, 06 Apr 2025   Prob (F-statistic):          1.19e-111
Time:                        13:35:55   Log-Likelihood:                -4541.7
No. Observations:                 522   AIC:                             9091.
Df Residuals:                     518   BIC:                             9108.
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const       4652.1226   2050.412      2.269      0.024     623.978    8680.268
x1            20.5814      5.133      4.010      0.000      10.498      30.665
x2            39.7328      1.342     29.605      0.000      37.096      42.369
x3            55.6552     13.271      4.194      0.000      29.584      81.726
==============================================================================
Omnibus:                        4.773   Durbin-Watson:                   1.958
Prob(Omnibus):                  0.092   Jarque-Bera (JB):                4.593
Skew:                           0.223   Prob(JB):                        0.101
Kurtosis:                       3.108   Cond. No.                     8.24e+03
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 8.24e+03. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<p>Now we move on to a MAR model. First starting with Stata.</p>
<div id="c875e971-3729-4c62-b376-629661478190" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>stata</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>clear</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set seed</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> seed <span class="dv">123</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set number of observations</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> obs <span class="dv">1000</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#1</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>drawnorm x1, n(<span class="dv">1000</span>) means(<span class="dv">40</span>) sds(<span class="dv">12</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#2</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>drawnorm x2, n(<span class="dv">1000</span>) means(<span class="dv">200</span>) sds(<span class="dv">50</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#3</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>drawnorm x3, n(<span class="dv">1000</span>) means(<span class="dv">150</span>) sds(<span class="dv">5</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric dependent variable <span class="cf">with</span> large coefficients</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>gen y <span class="op">=</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnormal(<span class="dv">5000</span>, <span class="dv">1500</span>)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate MAR</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>gen prob_mar <span class="op">=</span> logistic(y<span class="op">-</span><span class="dv">21791</span>)</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>gen rmar <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> prob_mar<span class="op">==</span><span class="dv">0</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>replace x2 <span class="op">=</span> . <span class="cf">if</span> rmar <span class="op">==</span> <span class="dv">0</span>  <span class="op">//</span> Set x to missing where rmar <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>regress y x1 x2 x3</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>etable, append</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>twoway (scatter y x2) (lfit y x2), title(<span class="st">"Scatter Plot with Line of Best Fit"</span>) legend(off)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
. 
. clear

. 
. * Set seed
. set seed 123

. 
. * Set number of observations
. set obs 1000
Number of observations (_N) was 0, now 1,000.

. 
. * Generate metric independent variable #1
. drawnorm x1, n(1000) means(40) sds(12)

. 
. * Generate metric independent variable #2
. drawnorm x2, n(1000) means(200) sds(50)

. 
. * Generate metric independent variable #3
. drawnorm x3, n(1000) means(150) sds(5)

. 
. * Generate metric dependent variable with large coefficients
. gen y = 30*x1 + 40*x2 + 50*x3 + rnormal(5000, 1500)

. 
. * Generate MAR
. gen prob_mar = logistic(y-21791)

. gen rmar = 0 if prob_mar==0
(500 missing values generated)

. replace x2 = . if rmar == 0  // Set x to missing where rmar == 0
(500 real changes made, 500 to missing)

. regress y x1 x2 x3

      Source |       SS           df       MS      Number of obs   =       500
-------------+----------------------------------   F(3, 496)       =    122.89
       Model |   552925039         3   184308346   Prob &gt; F        =    0.0000
    Residual |   743864709       496  1499727.24   R-squared       =    0.4264
-------------+----------------------------------   Adj R-squared   =    0.4229
       Total |  1.2968e+09       499  2598777.05   Root MSE        =    1224.6

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |   20.14886   4.982177     4.04   0.000     10.36009    29.93763
          x2 |   26.96303   1.407434    19.16   0.000     24.19777     29.7283
          x3 |    19.7006   10.99788     1.79   0.074    -1.907582    41.30878
       _cons |   13742.28   1717.077     8.00   0.000     10368.64    17115.92
------------------------------------------------------------------------------

. 
. etable, append

-------------------------------------------------------------------
                            y          2           y          y    
-------------------------------------------------------------------
x1                         29.409      29.409     25.214     20.149
                          (4.032)     (4.024)    (5.942)    (4.982)
x2                         42.717      42.717     42.557     26.963
                          (0.944)     (0.942)    (1.385)    (1.407)
x3                         54.520      54.520     48.179     19.701
                          (9.246)     (9.227)   (13.133)   (10.998)
Intercept                3778.896    3778.896   4912.711  13742.276
                       (1402.667)  (1399.858) (2007.467) (1717.077)
var(e.y)                             2.20e+06                      
                                  (98396.280)                      
Number of observations       1000        1000        508        500
-------------------------------------------------------------------

. 
. twoway (scatter y x2) (lfit y x2), title("Scatter Plot with Line of Best Fit"
&gt; ) legend(off)

. </code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Handling_Missing_Data_Methods_Software_files/figure-html/cell-24-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="49af51ba-0070-4f40-bc76-c70f2367fe1e" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary library</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>.seed(<span class="dv">123</span>)  <span class="co"># Ensure reproducibility</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric independent variables</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">40</span>, sd <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">200</span>, sd <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">150</span>, sd <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric dependent variable</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>y <span class="op">&lt;-</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">5000</span>, sd <span class="op">=</span> <span class="dv">1500</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate MAR (Missing At Random) pattern</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>prob_mar <span class="op">&lt;-</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> exp(<span class="op">-</span>(y <span class="op">-</span> <span class="dv">21791</span>)))  <span class="co"># Logistic function</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>rmar <span class="op">&lt;-</span> rbinom(<span class="dv">1000</span>, <span class="dv">1</span>, prob_mar)  <span class="co"># Generate missing indicator based on probability</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>x2[rmar <span class="op">==</span> <span class="dv">0</span>] <span class="op">&lt;-</span> NA  <span class="co"># Set x2 to NA for MAR missingness</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>data <span class="op">&lt;-</span> data.frame(y, x1, x2, x3)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Run OLS regression (listwise deletion by default)</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">&lt;-</span> lm(y <span class="op">~</span> x1 <span class="op">+</span> x2 <span class="op">+</span> x3, data <span class="op">=</span> data, na.action <span class="op">=</span> na.omit)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display regression results</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>summary(ols_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2 + x3, data = data, na.action = na.omit)

Residuals:
    Min      1Q  Median      3Q     Max 
-2876.0  -828.4   -78.3   670.2  3761.0 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 12209.232   1598.736   7.637 1.13e-13 ***
x1             19.693      4.588   4.292 2.12e-05 ***
x2             24.731      1.351  18.300  &lt; 2e-16 ***
x3             33.021     10.191   3.240  0.00127 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1161 on 504 degrees of freedom
  (492 observations deleted due to missingness)
Multiple R-squared:  0.4173,    Adjusted R-squared:  0.4138 
F-statistic: 120.3 on 3 and 504 DF,  p-value: &lt; 2.2e-16
</code></pre>
</div>
</div>
<div id="048e2af7-d059-49ea-af90-79f0a2fa77dd" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set number of observations</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate independent variables</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> np.random.normal(<span class="dv">40</span>, <span class="dv">12</span>, n)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> np.random.normal(<span class="dv">200</span>, <span class="dv">50</span>, n)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">=</span> np.random.normal(<span class="dv">150</span>, <span class="dv">5</span>, n)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate dependent variable</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">3</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>x3 <span class="op">+</span> np.random.normal(<span class="dv">500</span>, <span class="dv">150</span>, n)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate MAR (Missing At Random) for x2</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic function with scaled y values</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>prob_mar <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(y<span class="op">-</span><span class="dv">2050</span>))  <span class="co"># Apply logistic function</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>rmar <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, prob_mar)  <span class="co"># Generate MAR indicator</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>x2[rmar <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> np.nan  <span class="co"># Set x2 to missing</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame({<span class="st">'y'</span>: y, <span class="st">'x1'</span>: x1, <span class="st">'x2'</span>: x2, <span class="st">'x3'</span>: x3})</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Run OLS regression (listwise deletion by default)</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>data_clean <span class="op">=</span> data.dropna()  <span class="co"># Remove rows with missing values</span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(data_clean[[<span class="st">'x1'</span>, <span class="st">'x2'</span>, <span class="st">'x3'</span>]])  <span class="co"># Add intercept</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(data_clean[<span class="st">'y'</span>], X).fit()</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Display regression results</span></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.398
Model:                            OLS   Adj. R-squared:                  0.395
Method:                 Least Squares   F-statistic:                     116.1
Date:                Sun, 06 Apr 2025   Prob (F-statistic):           9.95e-58
Time:                        13:35:55   Log-Likelihood:                -3262.9
No. Observations:                 531   AIC:                             6534.
Df Residuals:                     527   BIC:                             6551.
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const        872.2379    153.985      5.664      0.000     569.737    1174.738
x1             1.9156      0.407      4.708      0.000       1.116       2.715
x2             2.3273      0.128     18.251      0.000       2.077       2.578
x3             3.3532      1.005      3.338      0.001       1.380       5.327
==============================================================================
Omnibus:                        7.685   Durbin-Watson:                   1.802
Prob(Omnibus):                  0.021   Jarque-Bera (JB):                7.560
Skew:                          -0.275   Prob(JB):                       0.0228
Kurtosis:                       3.201   Cond. No.                     7.31e+03
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 7.31e+03. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<p>Now we have our baseline MAR model for each software, now we can focus on implementing potential handling missing data solutions. Starting with Stata and Single mean imputation.</p>
<div id="5bb00f90-3681-435a-8076-fa3ea7cb5a06" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>stata</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>clear</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set seed</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> seed <span class="dv">123</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set number of observations</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> obs <span class="dv">1000</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#1</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>drawnorm x1, n(<span class="dv">1000</span>) means(<span class="dv">40</span>) sds(<span class="dv">12</span>)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#2</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>drawnorm x2, n(<span class="dv">1000</span>) means(<span class="dv">200</span>) sds(<span class="dv">50</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#3</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>drawnorm x3, n(<span class="dv">1000</span>) means(<span class="dv">150</span>) sds(<span class="dv">5</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric dependent variable <span class="cf">with</span> large coefficients</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>gen y <span class="op">=</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnormal(<span class="dv">5000</span>, <span class="dv">1500</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate MAR</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>gen prob_mar <span class="op">=</span> logistic(y<span class="op">-</span><span class="dv">21791</span>)</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>gen rmar <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> prob_mar<span class="op">==</span><span class="dv">0</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>replace x2 <span class="op">=</span> . <span class="cf">if</span> rmar <span class="op">==</span> <span class="dv">0</span>  <span class="op">//</span> Set x to missing where rmar <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>summarize x2, meanonly</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>replace x2 <span class="op">=</span> r(mean) <span class="cf">if</span> missing(x2)</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>regress y x1 x2 x3</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>etable, append</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>twoway (scatter y x2) (lfit y x2), title(<span class="st">"Scatter Plot with Line of Best Fit"</span>) legend(off)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
. 
. clear

. 
. * Set seed
. set seed 123

. 
. * Set number of observations
. set obs 1000
Number of observations (_N) was 0, now 1,000.

. 
. * Generate metric independent variable #1
. drawnorm x1, n(1000) means(40) sds(12)

. 
. * Generate metric independent variable #2
. drawnorm x2, n(1000) means(200) sds(50)

. 
. * Generate metric independent variable #3
. drawnorm x3, n(1000) means(150) sds(5)

. 
. * Generate metric dependent variable with large coefficients
. gen y = 30*x1 + 40*x2 + 50*x3 + rnormal(5000, 1500)

. 
. * Generate MAR
. gen prob_mar = logistic(y-21791)

. gen rmar = 0 if prob_mar==0
(500 missing values generated)

. replace x2 = . if rmar == 0  // Set x to missing where rmar == 0
(500 real changes made, 500 to missing)

. 
. summarize x2, meanonly

. replace x2 = r(mean) if missing(x2)
(500 real changes made)

. 
. regress y x1 x2 x3

      Source |       SS           df       MS      Number of obs   =     1,000
-------------+----------------------------------   F(3, 996)       =     44.23
       Model |   814884957         3   271628319   Prob &gt; F        =    0.0000
    Residual |  6.1174e+09       996  6141946.06   R-squared       =    0.1175
-------------+----------------------------------   Adj R-squared   =    0.1149
       Total |  6.9323e+09       999  6939202.43   Root MSE        =    2478.3

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |   36.86274   6.772257     5.44   0.000     23.57321    50.15227
          x2 |   28.00538    2.82263     9.92   0.000      22.4664    33.54436
          x3 |    63.7622   15.41944     4.14   0.000     33.50389    94.02052
       _cons |   4173.834   2437.463     1.71   0.087    -609.3184    8956.987
------------------------------------------------------------------------------

. 
. etable, append

------------------------------------------------------------------------------
                            y          2           y          y          y    
------------------------------------------------------------------------------
x1                         29.409      29.409     25.214     20.149     36.863
                          (4.032)     (4.024)    (5.942)    (4.982)    (6.772)
x2                         42.717      42.717     42.557     26.963     28.005
                          (0.944)     (0.942)    (1.385)    (1.407)    (2.823)
x3                         54.520      54.520     48.179     19.701     63.762
                          (9.246)     (9.227)   (13.133)   (10.998)   (15.419)
Intercept                3778.896    3778.896   4912.711  13742.276   4173.834
                       (1402.667)  (1399.858) (2007.467) (1717.077) (2437.463)
var(e.y)                             2.20e+06                                 
                                  (98396.280)                                 
Number of observations       1000        1000        508        500       1000
------------------------------------------------------------------------------

. 
. twoway (scatter y x2) (lfit y x2), title("Scatter Plot with Line of Best Fit"
&gt; ) legend(off)

. </code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Handling_Missing_Data_Methods_Software_files/figure-html/cell-27-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e0dbf492-992c-4974-b4a4-7a2e6533b46d" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>.seed(<span class="dv">123</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric independent variables</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">40</span>, sd <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">200</span>, sd <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">150</span>, sd <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric dependent variable</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>y <span class="op">&lt;-</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">5000</span>, sd <span class="op">=</span> <span class="dv">1500</span>)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate MAR (Missing At Random) for x2 using logistic function</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>prob_mar <span class="op">&lt;-</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> exp(<span class="op">-</span>(y <span class="op">-</span> <span class="dv">21791</span>)))  <span class="co"># Logistic function</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>rmar <span class="op">&lt;-</span> rbinom(<span class="dv">1000</span>, <span class="dv">1</span>, prob_mar)  <span class="co"># Generate MAR indicator</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>x2[rmar <span class="op">==</span> <span class="dv">0</span>] <span class="op">&lt;-</span> NA  <span class="co"># Set x2 to missing where rmar == 0</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary statistics for x2 (mean only)</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>mean_x2 <span class="op">&lt;-</span> mean(x2, na.rm <span class="op">=</span> TRUE)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace missing values of x2 with the mean of x2</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>x2[<span class="kw">is</span>.na(x2)] <span class="op">&lt;-</span> mean_x2</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with the variables</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>data <span class="op">&lt;-</span> data.frame(y, x1, x2, x3)</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Run OLS regression</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>model <span class="op">&lt;-</span> lm(y <span class="op">~</span> x1 <span class="op">+</span> x2 <span class="op">+</span> x3, data <span class="op">=</span> data)</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the regression results</span></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>summary(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2 + x3, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-7956.9 -1644.3   163.7  1915.5  5959.5 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 1910.091   2459.762   0.777    0.438    
x1            43.837      6.384   6.866 1.16e-11 ***
x2            24.910      2.794   8.915  &lt; 2e-16 ***
x3            81.888     15.540   5.270 1.68e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 2401 on 996 degrees of freedom
Multiple R-squared:  0.1319,    Adjusted R-squared:  0.1293 
F-statistic: 50.46 on 3 and 996 DF,  p-value: &lt; 2.2e-16
</code></pre>
</div>
</div>
<div id="2764e1cc-9662-41b7-82d7-b876c29ce409" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set number of observations</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate independent variables</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> np.random.normal(<span class="dv">40</span>, <span class="dv">12</span>, n)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> np.random.normal(<span class="dv">200</span>, <span class="dv">50</span>, n)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">=</span> np.random.normal(<span class="dv">150</span>, <span class="dv">5</span>, n)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate dependent variable</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">3</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>x3 <span class="op">+</span> np.random.normal(<span class="dv">500</span>, <span class="dv">150</span>, n)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate MAR (Missing At Random) for x2</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic function with scaled y values</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>prob_mar <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(y<span class="op">-</span><span class="dv">2050</span>))  <span class="co"># Apply logistic function</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>rmar <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, prob_mar)  <span class="co"># Generate MAR indicator</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>x2[rmar <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> np.nan  <span class="co"># Set x2 to missing</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace missing values in x2 with the mean of x2</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>x2[np.isnan(x2)] <span class="op">=</span> np.nanmean(x2)</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame({<span class="st">'y'</span>: y, <span class="st">'x1'</span>: x1, <span class="st">'x2'</span>: x2, <span class="st">'x3'</span>: x3})</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Run OLS regression (listwise deletion by default)</span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(data[[<span class="st">'x1'</span>, <span class="st">'x2'</span>, <span class="st">'x3'</span>]])  <span class="co"># Add intercept</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(data[<span class="st">'y'</span>], X).fit()</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Display regression results</span></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.094
Model:                            OLS   Adj. R-squared:                  0.091
Method:                 Least Squares   F-statistic:                     34.32
Date:                Sun, 06 Apr 2025   Prob (F-statistic):           4.11e-21
Time:                        13:35:55   Log-Likelihood:                -6848.0
No. Observations:                1000   AIC:                         1.370e+04
Df Residuals:                     996   BIC:                         1.372e+04
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const        958.4029    228.310      4.198      0.000     510.379    1406.427
x1             2.6749      0.604      4.426      0.000       1.489       3.861
x2             2.3577      0.256      9.202      0.000       1.855       2.860
x3             3.7336      1.473      2.535      0.011       0.844       6.623
==============================================================================
Omnibus:                       45.270   Durbin-Watson:                   1.968
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               29.371
Skew:                           0.292   Prob(JB):                     4.19e-07
Kurtosis:                       2.398   Cond. No.                     7.36e+03
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 7.36e+03. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<p>Now we move on to FIML approaches with Stata first.</p>
<div id="b6ec25f6-0a58-42b7-a387-3d4c686c0161" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>stata</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>clear</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set seed</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> seed <span class="dv">123</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set number of observations</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> obs <span class="dv">1000</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#1</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>drawnorm x1, n(<span class="dv">1000</span>) means(<span class="dv">40</span>) sds(<span class="dv">12</span>)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#2</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>drawnorm x2, n(<span class="dv">1000</span>) means(<span class="dv">200</span>) sds(<span class="dv">50</span>)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#3</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>drawnorm x3, n(<span class="dv">1000</span>) means(<span class="dv">150</span>) sds(<span class="dv">5</span>)</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric dependent variable <span class="cf">with</span> large coefficients</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>gen y <span class="op">=</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnormal(<span class="dv">5000</span>, <span class="dv">1500</span>)</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate MAR</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>gen prob_mar <span class="op">=</span> logistic(y<span class="op">-</span><span class="dv">21791</span>)</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>gen rmar <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> prob_mar<span class="op">==</span><span class="dv">0</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>replace x2 <span class="op">=</span> . <span class="cf">if</span> rmar <span class="op">==</span> <span class="dv">0</span>  <span class="op">//</span> Set x to missing where rmar <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Model estimation</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>sem (y <span class="op">&lt;-</span> x1 x2 x3), method(mlmv)</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>etable, append</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>twoway (scatter y x2) (lfit y x2), title(<span class="st">"Scatter Plot with Line of Best Fit"</span>) legend(off)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
. 
. clear

. 
. * Set seed
. set seed 123

. 
. * Set number of observations
. set obs 1000
Number of observations (_N) was 0, now 1,000.

. 
. * Generate metric independent variable #1
. drawnorm x1, n(1000) means(40) sds(12)

. 
. * Generate metric independent variable #2
. drawnorm x2, n(1000) means(200) sds(50)

. 
. * Generate metric independent variable #3
. drawnorm x3, n(1000) means(150) sds(5)

. 
. * Generate metric dependent variable with large coefficients
. gen y = 30*x1 + 40*x2 + 50*x3 + rnormal(5000, 1500)

. 
. * Generate MAR
. gen prob_mar = logistic(y-21791)

. gen rmar = 0 if prob_mar==0
(500 missing values generated)

. replace x2 = . if rmar == 0  // Set x to missing where rmar == 0
(500 real changes made, 500 to missing)

.     
. * Model estimation
. sem (y &lt;- x1 x2 x3), method(mlmv)
note: Missing values found in observed exogenous variables. Using the
      noxconditional behavior. Specify the forcexconditional option to
      override this behavior.
Endogenous variables
  Observed: y

Exogenous variables
  Observed: x1 x2 x3

Fitting saturated model:
Iteration 0:  Log likelihood = -19809.893  
Iteration 1:  Log likelihood = -18956.184  
Iteration 2:  Log likelihood = -18603.225  
Iteration 3:  Log likelihood = -18601.025  
Iteration 4:  Log likelihood =     -18601  
Iteration 5:  Log likelihood =     -18601  

Fitting baseline model:
Iteration 0:  Log likelihood = -18886.253  
Iteration 1:  Log likelihood =  -18792.75  
Iteration 2:  Log likelihood =  -18757.19  
Iteration 3:  Log likelihood = -18754.887  
Iteration 4:  Log likelihood = -18754.864  
Iteration 5:  Log likelihood = -18754.864  

Fitting target model:
Iteration 0:  Log likelihood =     -18601  
Iteration 1:  Log likelihood =     -18601  

Structural equation model                                Number of obs = 1,000
Estimation method: mlmv

Log likelihood = -18601

------------------------------------------------------------------------------
             |                 OIM
             | Coefficient  std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
Structural   |
  y          |
          x1 |   38.10574   5.583454     6.82   0.000     27.16237    49.04911
          x2 |   41.70024   1.300009    32.08   0.000     39.15227    44.24821
          x3 |   40.31928   12.42463     3.25   0.001     15.96746     64.6711
       _cons |   5775.744   1925.672     3.00   0.003     2001.496    9549.992
-------------+----------------------------------------------------------------
     mean(x1)|   40.24597   .3686473   109.17   0.000     39.52343    40.96851
     mean(x2)|   200.6471   2.530853    79.28   0.000     195.6867    205.6075
     mean(x3)|    149.797   .1607991   931.58   0.000     149.4818    150.1121
-------------+----------------------------------------------------------------
     var(e.y)|    2300879   187511.7                       1961212     2699374
      var(x1)|   135.9009   6.077671                       124.496    148.3505
      var(x2)|    2554.76   197.2925                      2195.916    2972.244
      var(x3)|   25.85634   1.156331                      23.68646      28.225
-------------+----------------------------------------------------------------
   cov(x1,x2)|  -29.66936    22.2683    -1.33   0.183    -73.31444    13.97571
   cov(x1,x3)|   1.100681   1.874863     0.59   0.557    -2.573983    4.775344
   cov(x2,x3)|   12.02246   9.573148     1.26   0.209    -6.740568    30.78548
------------------------------------------------------------------------------
LR test of model vs. saturated: chi2(0) = 0.00                 Prob &gt; chi2 = .

. 
. etable, append

-----------------------------------------------------------------------------------------
                            y          2           y          y          y          6    
-----------------------------------------------------------------------------------------
x1                         29.409      29.409     25.214     20.149     36.863     38.106
                          (4.032)     (4.024)    (5.942)    (4.982)    (6.772)    (5.583)
x2                         42.717      42.717     42.557     26.963     28.005     41.700
                          (0.944)     (0.942)    (1.385)    (1.407)    (2.823)    (1.300)
x3                         54.520      54.520     48.179     19.701     63.762     40.319
                          (9.246)     (9.227)   (13.133)   (10.998)   (15.419)   (12.425)
Intercept                3778.896    3778.896   4912.711  13742.276   4173.834   5775.744
                       (1402.667)  (1399.858) (2007.467) (1717.077) (2437.463) (1925.672)
var(e.y)                             2.20e+06                                    2.30e+06
                                  (98396.280)                                  (1.88e+05)
mean(x1)                                                                           40.246
                                                                                  (0.369)
mean(x2)                                                                          200.647
                                                                                  (2.531)
mean(x3)                                                                          149.797
                                                                                  (0.161)
var(x1)                                                                           135.901
                                                                                  (6.078)
var(x2)                                                                          2554.760
                                                                                (197.292)
var(x3)                                                                            25.856
                                                                                  (1.156)
cov(x1,x2)                                                                        -29.669
                                                                                 (22.268)
cov(x1,x3)                                                                          1.101
                                                                                  (1.875)
cov(x2,x3)                                                                         12.022
                                                                                  (9.573)
Number of observations       1000        1000        508        500       1000       1000
-----------------------------------------------------------------------------------------

. 
. twoway (scatter y x2) (lfit y x2), title("Scatter Plot with Line of Best Fit"
&gt; ) legend(off)

. </code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Handling_Missing_Data_Methods_Software_files/figure-html/cell-30-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="da6a1034-2b4f-45ca-a934-f78c015f9bb3" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>.seed(<span class="dv">123</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric independent variables</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">40</span>, sd <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">200</span>, sd <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">150</span>, sd <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric dependent variable</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>y <span class="op">&lt;-</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">5000</span>, sd <span class="op">=</span> <span class="dv">1500</span>)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate MAR (Missing At Random) for x2</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>prob_mar <span class="op">&lt;-</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> exp(<span class="op">-</span>(y <span class="op">-</span> <span class="dv">21791</span>)))  <span class="co"># Logistic function</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>rmar <span class="op">&lt;-</span> ifelse(prob_mar <span class="op">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)  <span class="co"># 0 if prob_mar is 0, 1 otherwise</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>x2[rmar <span class="op">==</span> <span class="dv">0</span>] <span class="op">&lt;-</span> NA  <span class="co"># Set x2 to missing where rmar == 0</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Load 'lavaan' package for SEM (Structural Equation Modeling)</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>library(lavaan)</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the model formula (SEM model)</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">&lt;-</span> <span class="st">'</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="er">  y ~ x1 + x2 + x3  # y as a function of x1, x2, and x3</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="co">'</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="er"># Fit the model using the 'lavaan' package</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>fit <span class="op">&lt;-</span> sem(model, data <span class="op">=</span> data.frame(y, x1, x2, x3))</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the model summary</span></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>summary(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-18 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         4

                                                  Used       Total
  Number of observations                           606        1000

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate     Std.Err   z-value  P(&gt;|z|)
  y ~                                                     
    x1                  19.799     4.270    4.637    0.000
    x2                  27.159     1.260   21.549    0.000
    x3                  41.840     9.653    4.334    0.000

Variances:
                   Estimate     Std.Err   z-value  P(&gt;|z|)
   .y              1469996.086 84449.069   17.407    0.000
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>In addition: Warning message:
lavaan-&gt;lav_data_full():  
   some observed variances are larger than 1000000 use varTable(fit) to 
   investigate </code></pre>
</div>
</div>
<p>To my knowledge, there is no viable FIML estimation practice within Python. This makes it impossible to use FIML as a handling missing data technique in Python and as such you have to use alternative methods such as Imputation. This will now be demonstrated, again starting with Stata. For the purposes of this simulation, as all variables are continuous a MVN Multiple Imputation approach can be used, though MICE allows for variables of different types to be imputed.</p>
<div id="07b63b2a-a348-4b13-a2e2-9d4a8ffe5a76" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>stata</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>clear</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set seed</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> seed <span class="dv">123</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Set number of observations</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> obs <span class="dv">1000</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#1</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>drawnorm x1, n(<span class="dv">1000</span>) means(<span class="dv">40</span>) sds(<span class="dv">12</span>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#2</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>drawnorm x2, n(<span class="dv">1000</span>) means(<span class="dv">200</span>) sds(<span class="dv">50</span>)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric independent variable <span class="co">#3</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>drawnorm x3, n(<span class="dv">1000</span>) means(<span class="dv">150</span>) sds(<span class="dv">5</span>)</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate metric dependent variable <span class="cf">with</span> large coefficients</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>gen y <span class="op">=</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnormal(<span class="dv">5000</span>, <span class="dv">1500</span>)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> Generate MAR</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>gen prob_mar <span class="op">=</span> logistic(y<span class="op">-</span><span class="dv">21791</span>)</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>gen rmar <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> prob_mar<span class="op">==</span><span class="dv">0</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>replace x2 <span class="op">=</span> . <span class="cf">if</span> rmar <span class="op">==</span> <span class="dv">0</span>  <span class="op">//</span> Set x to missing where rmar <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>mi <span class="bu">set</span> wide</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>mi register imputed y x1 x2 x3</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>tab _mi_miss</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>mi impute chained <span class="op">///</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a><span class="op">///</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>(regress) y x1 x2 x3 <span class="op">///</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>, rseed(<span class="dv">12345</span>) dots force add(<span class="dv">10</span>) burnin(<span class="dv">10</span>) </span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>mi estimate, post dots: regress y x1 x2 x3</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>etable, append</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
. 
. clear

. 
. * Set seed
. set seed 123

. 
. * Set number of observations
. set obs 1000
Number of observations (_N) was 0, now 1,000.

. 
. * Generate metric independent variable #1
. drawnorm x1, n(1000) means(40) sds(12)

. 
. * Generate metric independent variable #2
. drawnorm x2, n(1000) means(200) sds(50)

. 
. * Generate metric independent variable #3
. drawnorm x3, n(1000) means(150) sds(5)

. 
. * Generate metric dependent variable with large coefficients
. gen y = 30*x1 + 40*x2 + 50*x3 + rnormal(5000, 1500)

. 
. * Generate MAR
. gen prob_mar = logistic(y-21791)

. gen rmar = 0 if prob_mar==0
(500 missing values generated)

. replace x2 = . if rmar == 0  // Set x to missing where rmar == 0
(500 real changes made, 500 to missing)

.     
. mi set wide

. 
. mi register imputed y x1 x2 x3

. 
. tab _mi_miss

 Incomplete |
observation |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        500       50.00       50.00
          1 |        500       50.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00

. 
. 
. mi impute chained ///
&gt; ///
&gt; (regress) y x1 x2 x3 ///
&gt; , rseed(12345) dots force add(10) burnin(10) 
note: variables y x1 x3 contain no soft missing (.) values; imputing nothing
note: missing-value pattern is monotone; no iteration performed.

Conditional models (monotone):
                x2: regress x2 x3 x1 y

Performing chained iterations:
  imputing m=1 through m=10 .........10 done

Multivariate imputation                     Imputations =       10
Chained equations                                 added =       10
Imputed: m=1 through m=10                       updated =        0

Initialization: monotone                     Iterations =        0
                                                burn-in =        0

                 y: linear regression
                x1: linear regression
                x2: linear regression
                x3: linear regression

------------------------------------------------------------------
                   |               Observations per m             
                   |----------------------------------------------
          Variable |   Complete   Incomplete   Imputed |     Total
-------------------+-----------------------------------+----------
                 y |       1000            0         0 |      1000
                x1 |       1000            0         0 |      1000
                x2 |        500          500       500 |      1000
                x3 |       1000            0         0 |      1000
------------------------------------------------------------------
(Complete + Incomplete = Total; Imputed is the minimum across m
 of the number of filled-in observations.)

. 
. 
. mi estimate, post dots: regress y x1 x2 x3

Imputations (10):
  .........10 done

Multiple-imputation estimates                   Imputations       =         10
Linear regression                               Number of obs     =      1,000
                                                Average RVI       =     2.3440
                                                Largest FMI       =     0.5779
                                                Complete DF       =        996
DF adjustment:   Small sample                   DF:     min       =      27.94
                                                        avg       =      60.86
                                                        max       =     124.57
Model F test:       Equal FMI                   F(   3,  106.8)   =     365.04
Within VCE type:          OLS                   Prob &gt; F          =     0.0000

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |   36.94599   4.821662     7.66   0.000       27.403    46.48898
          x2 |    42.0321   1.471605    28.56   0.000     39.01734    45.04686
          x3 |   39.50875   12.21717     3.23   0.002     15.03525    63.98224
       _cons |   5850.553    2031.63     2.88   0.007     1725.712    9975.395
------------------------------------------------------------------------------

. 
. etable, append

----------------------------------------------------------------------------------------------------
                            y          2           y          y          y          6          y    
----------------------------------------------------------------------------------------------------
x1                         29.409      29.409     25.214     20.149     36.863     38.106     36.946
                          (4.032)     (4.024)    (5.942)    (4.982)    (6.772)    (5.583)    (4.822)
x2                         42.717      42.717     42.557     26.963     28.005     41.700     42.032
                          (0.944)     (0.942)    (1.385)    (1.407)    (2.823)    (1.300)    (1.472)
x3                         54.520      54.520     48.179     19.701     63.762     40.319     39.509
                          (9.246)     (9.227)   (13.133)   (10.998)   (15.419)   (12.425)   (12.217)
Intercept                3778.896    3778.896   4912.711  13742.276   4173.834   5775.744   5850.553
                       (1402.667)  (1399.858) (2007.467) (1717.077) (2437.463) (1925.672) (2031.630)
var(e.y)                             2.20e+06                                    2.30e+06           
                                  (98396.280)                                  (1.88e+05)           
mean(x1)                                                                           40.246           
                                                                                  (0.369)           
mean(x2)                                                                          200.647           
                                                                                  (2.531)           
mean(x3)                                                                          149.797           
                                                                                  (0.161)           
var(x1)                                                                           135.901           
                                                                                  (6.078)           
var(x2)                                                                          2554.760           
                                                                                (197.292)           
var(x3)                                                                            25.856           
                                                                                  (1.156)           
cov(x1,x2)                                                                        -29.669           
                                                                                 (22.268)           
cov(x1,x3)                                                                          1.101           
                                                                                  (1.875)           
cov(x2,x3)                                                                         12.022           
                                                                                  (9.573)           
Number of observations       1000        1000        508        500       1000       1000       1000
----------------------------------------------------------------------------------------------------

. </code></pre>
</div>
</div>
<p>Now R code.</p>
<div id="09d308b6-4c55-4cc7-a81a-a5bfeaa188c3" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load the `mice` package for multiple imputation (if not already installed)</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>require(mice)) install.packages(<span class="st">"mice"</span>, dependencies <span class="op">=</span> TRUE)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>library(mice)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>.seed(<span class="dv">123</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric independent variables</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">40</span>, sd <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">200</span>, sd <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">&lt;-</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">150</span>, sd <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate metric dependent variable</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>y <span class="op">&lt;-</span> <span class="dv">30</span><span class="op">*</span>x1 <span class="op">+</span> <span class="dv">40</span><span class="op">*</span>x2 <span class="op">+</span> <span class="dv">50</span><span class="op">*</span>x3 <span class="op">+</span> rnorm(<span class="dv">1000</span>, mean <span class="op">=</span> <span class="dv">5000</span>, sd <span class="op">=</span> <span class="dv">1500</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate MAR (Missing At Random) for x2</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>prob_mar <span class="op">&lt;-</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> exp(<span class="op">-</span>(y <span class="op">-</span> <span class="dv">21791</span>)))  <span class="co"># Logistic function</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>rmar <span class="op">&lt;-</span> ifelse(prob_mar <span class="op">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)  <span class="co"># 0 if prob_mar is 0, 1 otherwise</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>x2[rmar <span class="op">==</span> <span class="dv">0</span>] <span class="op">&lt;-</span> NA  <span class="co"># Set x2 to missing where rmar == 0</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the data for multiple imputation</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>data <span class="op">&lt;-</span> data.frame(y, x1, x2, x3)</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform multiple imputation using chained equations (MICE)</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>imp <span class="op">&lt;-</span> mice(data, m <span class="op">=</span> <span class="dv">10</span>, method <span class="op">=</span> <span class="st">"pmm"</span>, seed <span class="op">=</span> <span class="dv">12345</span>)</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform regression after imputation</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>fit <span class="op">&lt;-</span> <span class="cf">with</span>(imp, lm(y <span class="op">~</span> x1 <span class="op">+</span> x2 <span class="op">+</span> x3))</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the results of the regression and display the estimates</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>pooled_results <span class="op">&lt;-</span> pool(fit)</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>summary(pooled_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 iter imp variable
  1   1  x2
  1   2  x2
  1   3  x2
  1   4  x2
  1   5  x2
  1   6  x2
  1   7  x2
  1   8  x2
  1   9  x2
  1   10  x2
  2   1  x2
  2   2  x2
  2   3  x2
  2   4  x2
  2   5  x2
  2   6  x2
  2   7  x2
  2   8  x2
  2   9  x2
  2   10  x2
  3   1  x2
  3   2  x2
  3   3  x2
  3   4  x2
  3   5  x2
  3   6  x2
  3   7  x2
  3   8  x2
  3   9  x2
  3   10  x2
  4   1  x2
  4   2  x2
  4   3  x2
  4   4  x2
  4   5  x2
  4   6  x2
  4   7  x2
  4   8  x2
  4   9  x2
  4   10  x2
  5   1  x2
  5   2  x2
  5   3  x2
  5   4  x2
  5   5  x2
  5   6  x2
  5   7  x2
  5   8  x2
  5   9  x2
  5   10  x2
         term   estimate   std.error statistic       df      p.value
1 (Intercept) 2184.92911 1901.113549  1.149289 415.6189 2.510977e-01
2          x1   30.19575    5.472728  5.517495 165.8509 1.299693e-07
3          x2   39.85730    1.632656 24.412548  80.6700 5.233432e-39
4          x3   67.14173   12.700619  5.286493 308.6763 2.363451e-07</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Loading required package: mice

Attaching package: ‘mice’

The following object is masked from ‘package:stats’:

    filter

The following objects are masked from ‘package:base’:

    cbind, rbind
</code></pre>
</div>
</div>
<p>And finally, python. (not currently working)</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>